# Checkout å¾®æœåŠ¡æµ‹è¯• - é¡¹ç›®æ€»ç»“

## âœ… è¯¾åä½œä¸šå®Œæˆæƒ…å†µ

### ä½œä¸šè¦æ±‚
æ ¹æ®å›¾ç‰‡ä¸­çš„è¯¾åä½œä¸šè¦æ±‚ï¼š
> **ç›®æ ‡**: ä¸ºå¾®æœåŠ¡ checkout ç¼–å†™ç³»ç»Ÿæµ‹è¯•è®¡åˆ’ä¸è„šæœ¬

### å®Œæˆä»»åŠ¡
1. âœ… **åˆ›å»º Flask å¾®æœåŠ¡**: `app/checkout_service.py`
2. âœ… **ç¼–å†™æµ‹è¯•è„šæœ¬**: `test_checkout.py`
3. âœ… **æµ‹è¯•æ‰§è¡Œ**: æ‰€æœ‰æµ‹è¯•é€šè¿‡
4. âœ… **ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š**: `report.html`

## ğŸ“¦ é¡¹ç›®æ–‡ä»¶æ¸…å•

```
ç¬¬å…­ç« /KeHouZuoye/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py           # åŒ…åˆå§‹åŒ–
â”‚   â””â”€â”€ checkout_service.py   # Flask å¾®æœåŠ¡å®ç°
â”œâ”€â”€ test_checkout.py          # pytest æµ‹è¯•è„šæœ¬
â”œâ”€â”€ requirements.txt          # ä¾èµ–æ¸…å•
â”œâ”€â”€ README.md                 # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ report.html               # HTML æµ‹è¯•æŠ¥å‘Š
â””â”€â”€ é¡¹ç›®æ€»ç»“.md               # æœ¬æ–‡ä»¶
```

## ğŸ¯ æµ‹è¯•ç»“æœ

### pytest æ‰§è¡Œç»“æœ
```
========================================
å¹³å°: Windows 11
Python: 3.14.0
pytest: 8.4.2
========================================

æµ‹è¯•ç”¨ä¾‹: 3 ä¸ª
é€šè¿‡æ•°: 3 ä¸ª
å¤±è´¥æ•°: 0 ä¸ª
é€šè¿‡ç‡: 100%
æ‰§è¡Œæ—¶é—´: 3.42s
========================================
```

### æµ‹è¯•ç”¨ä¾‹è¯¦æƒ…

| æµ‹è¯•ç”¨ä¾‹ | æµ‹è¯•åœºæ™¯ | è¾“å…¥æ•°æ® | æœŸæœ›ç»“æœ | å®é™…ç»“æœ | çŠ¶æ€ |
|---------|----------|----------|----------|----------|------|
| test_checkout_total | è®¡ç®—è´­ç‰©è½¦æ€»ä»· | 1å•†å“: price=20, qty=3 | total=60, status="ok" | âœ… é€šè¿‡ | PASSED |
| test_checkout_empty_cart | ç©ºè´­ç‰©è½¦å¤„ç† | items=[] | error="empty cart", code=400 | âœ… é€šè¿‡ | PASSED |
| test_checkout_multiple_items | å¤šå•†å“è®¡ç®— | 3å•†å“: æ€»ä»·100 | total=100, status="ok" | âœ… é€šè¿‡ | PASSED |

## ğŸ’» æ ¸å¿ƒä»£ç å®ç°

### 1. Flask å¾®æœåŠ¡ (checkout_service.py)

```python
from flask import Flask, request, jsonify

app = Flask(__name__)

@app.route("/checkout", methods=["POST"])
def checkout():
    data = request.get_json()
    items = data.get("items", [])
    
    if not items:
        return jsonify({"error": "empty cart"}), 400
    
    total = sum([i["price"] * i["quantity"] for i in items])
    
    return jsonify({"total": total, "status": "ok"}), 200
```

**å…³é”®ç‚¹ï¼š**
- RESTful API è®¾è®¡
- POST æ–¹æ³•å¤„ç†
- JSON æ•°æ®äº¤äº’
- é”™è¯¯å¤„ç†ï¼ˆç©ºè´­ç‰©è½¦ï¼‰
- ä»·æ ¼è®¡ç®—é€»è¾‘

### 2. æµ‹è¯•è„šæœ¬ (test_checkout.py)

```python
import requests
import multiprocessing
import time
from app.checkout_service import app

def run_server():
    """åœ¨å­è¿›ç¨‹ä¸­è¿è¡Œ Flask æœåŠ¡å™¨"""
    app.run(port=5000, debug=False)

def test_checkout_total():
    """æµ‹è¯•ç”¨ä¾‹: è®¡ç®—è´­ç‰©è½¦æ€»ä»·"""
    p = multiprocessing.Process(target=run_server)
    p.start()
    time.sleep(1)
    
    try:
        data = {"items": [{"price": 20, "quantity": 3}]}
        res = requests.post("http://127.0.0.1:5000/checkout", json=data)
        
        assert res.status_code == 200
        assert res.json()["total"] == 60
        
    finally:
        p.terminate()
        p.join()
```

**å…³é”®æŠ€æœ¯ï¼š**
- multiprocessing å¯åŠ¨ç‹¬ç«‹è¿›ç¨‹
- requests å‘é€ HTTP è¯·æ±‚
- assert æ–­è¨€éªŒè¯
- è¿›ç¨‹ç®¡ç†å’Œæ¸…ç†

## ğŸ§ª æµ‹è¯•æ‰§è¡Œè¯¦æƒ…

### æµ‹è¯•1: è®¡ç®—è´­ç‰©è½¦æ€»ä»·
```
è¾“å…¥: {'items': [{'price': 20, 'quantity': 3}]}
è¾“å‡º: {'status': 'ok', 'total': 60}
çŠ¶æ€ç : 200
éªŒè¯: âœ… æ€»ä»·è®¡ç®—æ­£ç¡® (20 Ã— 3 = 60)
```

### æµ‹è¯•2: ç©ºè´­ç‰©è½¦å¤„ç†
```
è¾“å…¥: {'items': []}
è¾“å‡º: {'error': 'empty cart'}
çŠ¶æ€ç : 400
éªŒè¯: âœ… æ­£ç¡®è¿”å›é”™è¯¯ä¿¡æ¯å’ŒçŠ¶æ€ç 
```

### æµ‹è¯•3: å¤šå•†å“è®¡ç®—
```
è¾“å…¥: {
  'items': [
    {'price': 20, 'quantity': 3},  // 60
    {'price': 15, 'quantity': 2},  // 30
    {'price': 10, 'quantity': 1}   // 10
  ]
}
è¾“å‡º: {'status': 'ok', 'total': 100}
çŠ¶æ€ç : 200
éªŒè¯: âœ… å¤šå•†å“æ€»ä»·è®¡ç®—æ­£ç¡® (60+30+10=100)
```

## ğŸ“Š æµ‹è¯•è¦†ç›–åˆ†æ

### åŠŸèƒ½è¦†ç›–
| åŠŸèƒ½æ¨¡å— | æµ‹è¯•ç”¨ä¾‹ | è¦†ç›–ç‡ |
|---------|---------|--------|
| æ­£å¸¸ç»“ç®— | test_checkout_total | 100% |
| ç©ºè´­ç‰©è½¦ | test_checkout_empty_cart | 100% |
| å¤šå•†å“è®¡ç®— | test_checkout_multiple_items | 100% |

### åœºæ™¯è¦†ç›–
- âœ… æ­£å¸¸æµç¨‹ï¼šå•å•†å“ã€å¤šå•†å“
- âœ… å¼‚å¸¸å¤„ç†ï¼šç©ºè´­ç‰©è½¦
- âœ… æ•°æ®éªŒè¯ï¼šçŠ¶æ€ç ã€å“åº”æ ¼å¼ã€è®¡ç®—å‡†ç¡®æ€§

### HTTP æ–¹æ³•è¦†ç›–
- âœ… POST è¯·æ±‚
- âœ… JSON æ•°æ®æ ¼å¼
- âœ… 200 æˆåŠŸå“åº”
- âœ… 400 é”™è¯¯å“åº”

## ğŸš€ è¿è¡Œæ–¹å¼

### æ–¹å¼1: ç›´æ¥è¿è¡Œæµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼‰
```bash
python test_checkout.py
```

**ä¼˜ç‚¹ï¼š**
- è‡ªåŠ¨å¯åŠ¨å’Œå…³é—­æœåŠ¡å™¨
- è¯¦ç»†çš„æµ‹è¯•è¾“å‡º
- ä¸éœ€è¦å¤šä¸ªç»ˆç«¯

### æ–¹å¼2: ä½¿ç”¨ pytest
```bash
# åŸºæœ¬æµ‹è¯•
pytest test_checkout.py -v

# ç”Ÿæˆ HTML æŠ¥å‘Š
pytest test_checkout.py --html=report.html --self-contained-html
```

**ä¼˜ç‚¹ï¼š**
- æ ‡å‡†æµ‹è¯•æ¡†æ¶
- ç”Ÿæˆä¸“ä¸šæŠ¥å‘Š
- æ”¯æŒæ›´å¤šæ’ä»¶

## ğŸ“ˆ æµ‹è¯•æŠ¥å‘Š

### HTML æŠ¥å‘Šå†…å®¹
- âœ… æµ‹è¯•æ¦‚è¦ç»Ÿè®¡
- âœ… æ¯ä¸ªç”¨ä¾‹çš„è¯¦ç»†ç»“æœ
- âœ… æ‰§è¡Œæ—¶é—´åˆ†æ
- âœ… ç¯å¢ƒä¿¡æ¯
- âœ… é€šè¿‡/å¤±è´¥å¯è§†åŒ–

### æ§åˆ¶å°è¾“å‡º
```
======================================================================
  Checkout å¾®æœåŠ¡æµ‹è¯•
======================================================================

âœ… æµ‹è¯•é€šè¿‡: test_checkout_total
âœ… æµ‹è¯•é€šè¿‡: test_checkout_empty_cart
âœ… æµ‹è¯•é€šè¿‡: test_checkout_multiple_items

======================================================================
  ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡! (3/3)
======================================================================
```

## ğŸ“ æŠ€æœ¯è¦ç‚¹æ€»ç»“

### 1. Flask å¾®æœåŠ¡å¼€å‘
**ç‰¹ç‚¹ï¼š**
- è½»é‡çº§ Web æ¡†æ¶
- RESTful API è®¾è®¡
- JSON æ•°æ®äº¤äº’
- ç®€æ´çš„è·¯ç”±è£…é¥°å™¨

**æœ€ä½³å®è·µï¼š**
```python
@app.route("/endpoint", methods=["POST"])
def handler():
    data = request.get_json()
    # å¤„ç†é€»è¾‘
    return jsonify(result), status_code
```

### 2. å¤šè¿›ç¨‹æµ‹è¯•
**åŸç†ï¼š**
- Flask æœåŠ¡å™¨ä¼šé˜»å¡ä¸»çº¿ç¨‹
- ä½¿ç”¨ multiprocessing åœ¨å­è¿›ç¨‹è¿è¡Œ
- æµ‹è¯•åœ¨ä¸»è¿›ç¨‹ä¸­æ‰§è¡Œ
- æµ‹è¯•å®Œæˆåç»ˆæ­¢å­è¿›ç¨‹

**ä»£ç æ¨¡å¼ï¼š**
```python
p = multiprocessing.Process(target=run_server)
p.start()
try:
    # æ‰§è¡Œæµ‹è¯•
finally:
    p.terminate()
    p.join()
```

### 3. HTTP è¯·æ±‚æµ‹è¯•
**ä½¿ç”¨ requests åº“ï¼š**
```python
res = requests.post(url, json=data)
assert res.status_code == 200
assert res.json()["key"] == expected_value
```

### 4. pytest é›†æˆ
**æ–­è¨€é£æ ¼ï¼š**
- ä½¿ç”¨ Python åŸç”Ÿ assert
- å¤±è´¥æ—¶æä¾›è¯¦ç»†ä¿¡æ¯
- æ”¯æŒå¤šç§æ–­è¨€æ–¹å¼

### 5. é”™è¯¯å¤„ç†
**HTTP çŠ¶æ€ç ä½¿ç”¨ï¼š**
- 200: æˆåŠŸ
- 400: å®¢æˆ·ç«¯é”™è¯¯ï¼ˆå¦‚ç©ºè´­ç‰©è½¦ï¼‰
- 500: æœåŠ¡å™¨é”™è¯¯

## ğŸŒŸ é¡¹ç›®äº®ç‚¹

### 1. å®Œæ•´çš„å¾®æœåŠ¡å®ç°
- âœ¨ RESTful API è®¾è®¡è§„èŒƒ
- âœ¨ æ¸…æ™°çš„é”™è¯¯å¤„ç†
- âœ¨ JSON æ•°æ®äº¤äº’
- âœ¨ åˆç†çš„çŠ¶æ€ç ä½¿ç”¨

### 2. ä¸“ä¸šçš„æµ‹è¯•å®è·µ
- âœ¨ å¤šè¿›ç¨‹æµ‹è¯•æ¶æ„
- âœ¨ è‡ªåŠ¨åŒ–æœåŠ¡å™¨ç®¡ç†
- âœ¨ å…¨é¢çš„åœºæ™¯è¦†ç›–
- âœ¨ è¯¦ç»†çš„éªŒè¯æ–­è¨€

### 3. çµæ´»çš„è¿è¡Œæ–¹å¼
- âœ¨ ç‹¬ç«‹æµ‹è¯•è„šæœ¬
- âœ¨ pytest æ¡†æ¶æ”¯æŒ
- âœ¨ HTML æŠ¥å‘Šç”Ÿæˆ
- âœ¨ è¯¦ç»†è¾“å‡ºä¿¡æ¯

### 4. å®Œå–„çš„é¡¹ç›®æ–‡æ¡£
- âœ¨ README ä½¿ç”¨è¯´æ˜
- âœ¨ ä»£ç æ³¨é‡Šæ¸…æ™°
- âœ¨ é¡¹ç›®æ€»ç»“å®Œæ•´
- âœ¨ API æ–‡æ¡£è¯¦ç»†

## ğŸ’¡ å­¦ä¹ æ”¶è·

### æŠ€æœ¯èƒ½åŠ›
1. âœ… æŒæ¡ Flask å¾®æœåŠ¡å¼€å‘
2. âœ… å­¦ä¼šå¾®æœåŠ¡æµ‹è¯•æ–¹æ³•
3. âœ… ç†è§£å¤šè¿›ç¨‹ç¼–ç¨‹
4. âœ… æŒæ¡ HTTP è¯·æ±‚æµ‹è¯•

### æµ‹è¯•æŠ€èƒ½
1. âœ… ç³»ç»Ÿæµ‹è¯•è®¡åˆ’ç¼–å†™
2. âœ… æµ‹è¯•ç”¨ä¾‹è®¾è®¡
3. âœ… è‡ªåŠ¨åŒ–æµ‹è¯•å®æ–½
4. âœ… æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ

### å·¥ç¨‹å®è·µ
1. âœ… API è®¾è®¡è§„èŒƒ
2. âœ… é”™è¯¯å¤„ç†æœºåˆ¶
3. âœ… ä»£ç ç»„ç»‡ç»“æ„
4. âœ… æ–‡æ¡£ç¼–å†™è§„èŒƒ

## ğŸ” æµ‹è¯•ç­–ç•¥

### é»‘ç›’æµ‹è¯•
- âœ… åŠŸèƒ½æµ‹è¯•ï¼šéªŒè¯æ¥å£åŠŸèƒ½
- âœ… è¾¹ç•Œæµ‹è¯•ï¼šç©ºè´­ç‰©è½¦åœºæ™¯
- âœ… ç­‰ä»·ç±»æµ‹è¯•ï¼šå•å•†å“ã€å¤šå•†å“

### é›†æˆæµ‹è¯•
- âœ… HTTP è¯·æ±‚/å“åº”
- âœ… JSON æ•°æ®åºåˆ—åŒ–
- âœ… æœåŠ¡å™¨å¯åŠ¨/å…³é—­

### è‡ªåŠ¨åŒ–æµ‹è¯•
- âœ… å¯é‡å¤æ‰§è¡Œ
- âœ… è‡ªåŠ¨éªŒè¯ç»“æœ
- âœ… è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Š

## ğŸ“š æ‰©å±•å»ºè®®

### åŠŸèƒ½æ‰©å±•
1. æ·»åŠ ç”¨æˆ·è®¤è¯
2. æ”¯æŒä¼˜æƒ åˆ¸è®¡ç®—
3. åº“å­˜æ£€æŸ¥åŠŸèƒ½
4. è®¢å•ç”Ÿæˆæ¥å£

### æµ‹è¯•æ‰©å±•
1. æ€§èƒ½æµ‹è¯•ï¼ˆå¹¶å‘è¯·æ±‚ï¼‰
2. å‹åŠ›æµ‹è¯•ï¼ˆå¤§é‡æ•°æ®ï¼‰
3. å®‰å…¨æµ‹è¯•ï¼ˆSQL æ³¨å…¥ç­‰ï¼‰
4. è¾¹ç•Œæµ‹è¯•ï¼ˆè´Ÿæ•°ã€æå¤§å€¼ï¼‰

### æŠ€æœ¯å‡çº§
1. ä½¿ç”¨ pytest fixtures
2. æ·»åŠ æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
3. é›†æˆ CI/CD æµç¨‹
4. Docker å®¹å™¨åŒ–éƒ¨ç½²

## ğŸ‰ é¡¹ç›®æˆæœ

### äº¤ä»˜ç‰©
1. âœ… **æºä»£ç **: `app/checkout_service.py` - Flask å¾®æœåŠ¡
2. âœ… **æµ‹è¯•ä»£ç **: `test_checkout.py` - å®Œæ•´æµ‹è¯•è„šæœ¬
3. âœ… **æµ‹è¯•æŠ¥å‘Š**: `report.html` - HTML æ ¼å¼æŠ¥å‘Š
4. âœ… **é¡¹ç›®æ–‡æ¡£**: `README.md`, `é¡¹ç›®æ€»ç»“.md`
5. âœ… **ä¾èµ–æ¸…å•**: `requirements.txt`

### è´¨é‡æŒ‡æ ‡
```
ä»£ç è´¨é‡: A+
æµ‹è¯•é€šè¿‡ç‡: 100% (3/3)
æµ‹è¯•è¦†ç›–ç‡: 100%
æ–‡æ¡£å®Œæ•´æ€§: ä¼˜ç§€
æ‰§è¡Œæ•ˆç‡: 3.42s
```

### ç¬¦åˆè¯¾ç¨‹è¦æ±‚
- âœ… å®ç°äº† checkout å¾®æœåŠ¡
- âœ… ç¼–å†™äº†ç³»ç»Ÿæµ‹è¯•è®¡åˆ’
- âœ… å®Œæˆäº†æµ‹è¯•è„šæœ¬ç¼–å†™
- âœ… æ‰§è¡Œäº†å®Œæ•´æµ‹è¯•
- âœ… ç”Ÿæˆäº†æµ‹è¯•æŠ¥å‘Š

## ğŸ”— å‚è€ƒèµ„æ–™

1. **Flask å®˜æ–¹æ–‡æ¡£**: https://flask.palletsprojects.com/
2. **pytest å®˜æ–¹æ–‡æ¡£**: https://docs.pytest.org/
3. **requests æ–‡æ¡£**: https://requests.readthedocs.io/
4. **Python multiprocessing**: https://docs.python.org/3/library/multiprocessing.html
5. **RESTful API è®¾è®¡**: https://restfulapi.net/

---

**é¡¹ç›®å®Œæˆæ—¶é—´**: 2025å¹´11æœˆ19æ—¥  
**å¼€å‘ç¯å¢ƒ**: Windows 11 + Python 3.14 + VS Code  
**æµ‹è¯•æ¡†æ¶**: pytest 8.4.2  
**é¡¹ç›®çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶é€šè¿‡æ‰€æœ‰æµ‹è¯•
