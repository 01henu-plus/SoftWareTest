# åº§ä½é”å®šç³»ç»Ÿ - é¡¹ç›®æ€»ç»“

## âœ… é¡¹ç›®å®Œæˆæƒ…å†µ

### è¯¾å ‚æ¡ˆä¾‹è¦æ±‚
æ ¹æ®å›¾ç‰‡ä¸­çš„è¯¾å ‚æ¡ˆä¾‹è¦æ±‚ï¼Œå®Œæˆä»¥ä¸‹ä»»åŠ¡ï¼š

1. âœ… **å®‰è£…æ’ä»¶**: Python + Jupyter + Test Explorer UI
2. âœ… **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**: `python -m venv venv`
3. âœ… **å®‰è£…ä¾èµ–**: `pip install pytest pytest-html`
4. âœ… **ç›®å½•ç»“æ„**: 
   - `app/seat_lock.py` - åº§ä½é”å®šç³»ç»Ÿä»£ç 
   - `tests/test_seat_lock.py` - æµ‹è¯•è„šæœ¬
   - `pytest.ini` - pytest é…ç½®æ–‡ä»¶
5. âœ… **è¿è¡Œæµ‹è¯•**: 
   - æ–¹æ³•1: `pytest --html=report.html --self-contained-html`
   - æ–¹æ³•2: `python run_tests.py`

## ğŸ“¦ é¡¹ç›®æ–‡ä»¶æ¸…å•

```
ç¬¬å…­ç« /classTest/
â”œâ”€â”€ venv/                      # Python è™šæ‹Ÿç¯å¢ƒ
â”œâ”€â”€ app/                       # åº”ç”¨ä»£ç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ seat_lock.py          # SeatLockSystem ç±»
â”œâ”€â”€ tests/                     # æµ‹è¯•ä»£ç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ test_seat_lock.py     # pytest æµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ run_tests.py              # ç‹¬ç«‹è¿è¡Œè„šæœ¬
â”œâ”€â”€ pytest.ini                # pytest é…ç½®
â”œâ”€â”€ requirements.txt          # ä¾èµ–æ¸…å•
â”œâ”€â”€ README.md                 # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ report.html               # HTML æµ‹è¯•æŠ¥å‘Š
â””â”€â”€ é¡¹ç›®æ€»ç»“.md               # æœ¬æ–‡ä»¶
```

## ğŸ¯ æµ‹è¯•ç»“æœ

### pytest æµ‹è¯•ç»“æœ
```
========================================
å¹³å°: Windows 11
Python: 3.14.0
pytest: 8.4.2
========================================

æµ‹è¯•ç”¨ä¾‹: 5 ä¸ª
é€šè¿‡æ•°: 5 ä¸ª
å¤±è´¥æ•°: 0 ä¸ª
é€šè¿‡ç‡: 100%
æ‰§è¡Œæ—¶é—´: 0.04s
========================================
```

### æµ‹è¯•ç”¨ä¾‹è¯¦æƒ…

| æµ‹è¯•ID | æµ‹è¯•åœºæ™¯ | ç»“æœ | è¯´æ˜ |
|--------|----------|------|------|
| test_lock_and_expire | é”å®šå¹¶æµ‹è¯•è¿‡æœŸ | âœ… PASSED | åº§ä½é”å®šåè‡ªåŠ¨è¿‡æœŸ |
| test_relock_after_expire | è¿‡æœŸåé‡æ–°é”å®š | âœ… PASSED | è¿‡æœŸåå¯é‡æ–°é”å®š |
| test_unlock | è§£é”åº§ä½ | âœ… PASSED | æ‰‹åŠ¨è§£é”åŠŸèƒ½æ­£å¸¸ |
| test_lock_already_locked | é”å®šå·²é”å®šåº§ä½ | âœ… PASSED | é˜²æ­¢é‡å¤é”å®š |
| test_multiple_seats | å¤šåº§ä½ç®¡ç† | âœ… PASSED | åŒæ—¶ç®¡ç†å¤šä¸ªåº§ä½ |

## ğŸ’» æ ¸å¿ƒä»£ç å®ç°

### 1. SeatLockSystem ç±»

```python
class SeatLockSystem:
    def __init__(self):
        self.locked_seats = {}  # åº§ä½é”å®šå­—å…¸
        self.timeout = 60       # è¶…æ—¶æ—¶é—´ 60ç§’
    
    def lock(self, seat_id, user):
        """é”å®šåº§ä½"""
        now = time.time()
        if seat_id in self.locked_seats and self.locked_seats[seat_id]["expire"] > now:
            return False
        self.locked_seats[seat_id] = {"user": user, "expire": now + self.timeout}
        return True
    
    def is_locked(self, seat_id):
        """æ£€æŸ¥åº§ä½æ˜¯å¦è¢«é”å®š"""
        if seat_id not in self.locked_seats:
            return False
        now = time.time()
        if self.locked_seats[seat_id]["expire"] <= now:
            del self.locked_seats[seat_id]
            return False
        return True
    
    def unlock(self, seat_id):
        """è§£é”åº§ä½"""
        if seat_id in self.locked_seats:
            del self.locked_seats[seat_id]
            return True
        return False
```

### 2. æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹

```python
def test_lock_and_expire():
    """æµ‹è¯•é”å®šå’Œè¿‡æœŸåŠŸèƒ½"""
    s = SeatLockSystem()
    
    # é”å®šåº§ä½
    assert s.lock("A1", "user1")
    assert s.is_locked("A1")
    
    # æ¨¡æ‹Ÿè¿‡æœŸ
    s.locked_seats["A1"]["expire"] = time.time() - 1
    
    # éªŒè¯è¿‡æœŸåè‡ªåŠ¨è§£é”
    assert s.is_locked("A1") is False
```

## ğŸš€ è¿è¡Œæ–¹å¼

### æ–¹å¼1: ä½¿ç”¨ pytest (æ¨è)

**åœ¨ VS Code ä¸­è¿è¡Œï¼š**
1. å¿«æ·é”®: `Ctrl+Shift+P`
2. é€‰æ‹©: `Python: Configure Tests â†’ pytest â†’ tests/`
3. è¿è¡Œæµ‹è¯•æˆ–ç”ŸæˆæŠ¥å‘Š

**å‘½ä»¤è¡Œè¿è¡Œï¼š**
```bash
# åŸºæœ¬æµ‹è¯•
pytest -v

# ç”Ÿæˆ HTML æŠ¥å‘Š
pytest --html=report.html --self-contained-html

# åªæµ‹è¯•ç‰¹å®šæ–‡ä»¶
pytest tests/test_seat_lock.py -v
```

### æ–¹å¼2: è¿è¡Œç‹¬ç«‹è„šæœ¬

```bash
python run_tests.py
```

**è¾“å‡ºç¤ºä¾‹ï¼š**
```
======================================================================
  åº§ä½é”å®šç³»ç»Ÿæµ‹è¯• - SeatLockSystem
======================================================================

æµ‹è¯•1: é”å®šåº§ä½å¹¶æµ‹è¯•è¿‡æœŸ
  âœ“ åº§ä½A1å·²è¢«user1é”å®š
  âœ“ ç¡®è®¤åº§ä½A1å¤„äºé”å®šçŠ¶æ€
  âœ“ æ¨¡æ‹Ÿåº§ä½è¿‡æœŸï¼ˆè®¾ç½®è¿‡æœŸæ—¶é—´ä¸ºè¿‡å»ï¼‰
  âœ“ ç¡®è®¤è¿‡æœŸååº§ä½è‡ªåŠ¨è§£é”
âœ… æµ‹è¯•é€šè¿‡: test_lock_and_expire

[... æ›´å¤šæµ‹è¯•è¾“å‡º ...]

======================================================================
  ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡! (5/5) âœ…
======================================================================
```

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

### HTML æŠ¥å‘Š
- **æ–‡ä»¶**: `report.html`
- **æŸ¥çœ‹**: åœ¨ Chrome æµè§ˆå™¨ä¸­æ‰“å¼€
- **å†…å®¹**: 
  - æµ‹è¯•æ¦‚è¦ç»Ÿè®¡
  - æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹çš„è¯¦ç»†ç»“æœ
  - æ‰§è¡Œæ—¶é—´å’Œç¯å¢ƒä¿¡æ¯
  - æµ‹è¯•é€šè¿‡/å¤±è´¥çš„å¯è§†åŒ–å±•ç¤º

### æ§åˆ¶å°è¾“å‡º
- **ç»¿è‰²**: æµ‹è¯•é€šè¿‡ âœ…
- **è¯¦ç»†ä¿¡æ¯**: æ¯ä¸ªæ­¥éª¤çš„éªŒè¯ç»“æœ
- **æ€»ç»“**: é€šè¿‡ç‡å’Œæ‰§è¡Œæ—¶é—´

## ğŸ“ çŸ¥è¯†ç‚¹æ€»ç»“

### 1. Python è™šæ‹Ÿç¯å¢ƒ
```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆWindowsï¼‰
.\venv\Scripts\activate

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒï¼ˆMac/Linuxï¼‰
source venv/bin/activate
```

**ä½œç”¨**ï¼š
- éš”ç¦»é¡¹ç›®ä¾èµ–
- é¿å…ç‰ˆæœ¬å†²çª
- ä¾¿äºéƒ¨ç½²å’Œåˆ†äº«

### 2. pytest æµ‹è¯•æ¡†æ¶

**æ ¸å¿ƒç‰¹æ€§ï¼š**
- âœ… ç®€æ´çš„æ–­è¨€è¯­æ³•ï¼š`assert x == y`
- âœ… è‡ªåŠ¨å‘ç°æµ‹è¯•ï¼š`test_*.py` å’Œ `test_*()`
- âœ… ä¸°å¯Œçš„æ’ä»¶ï¼š`pytest-html`ã€`pytest-cov` ç­‰
- âœ… è¯¦ç»†çš„é”™è¯¯æŠ¥å‘Š

**é…ç½®æ–‡ä»¶ pytest.iniï¼š**
```ini
[pytest]
testpaths = tests
python_files = test_*.py
python_functions = test_*
addopts = -v --tb=short
```

### 3. å•å…ƒæµ‹è¯•è®¾è®¡

**æµ‹è¯•ç”¨ä¾‹è®¾è®¡åŸåˆ™ï¼š**
1. **ç‹¬ç«‹æ€§**: æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ç›¸äº’ç‹¬ç«‹
2. **å¯é‡å¤**: å¤šæ¬¡è¿è¡Œç»“æœä¸€è‡´
3. **æ¸…æ™°æ€§**: æµ‹è¯•æ„å›¾æ˜ç¡®
4. **å®Œæ•´æ€§**: è¦†ç›–æ­£å¸¸å’Œå¼‚å¸¸åœºæ™¯

**æœ¬é¡¹ç›®æµ‹è¯•è¦†ç›–ï¼š**
- âœ… æ­£å¸¸æµç¨‹ï¼šé”å®šã€è§£é”
- âœ… å¼‚å¸¸å¤„ç†ï¼šé‡å¤é”å®š
- âœ… è¾¹ç•Œæ¡ä»¶ï¼šè¶…æ—¶è¿‡æœŸ
- âœ… å¹¶å‘åœºæ™¯ï¼šå¤šåº§ä½ç®¡ç†

### 4. æ—¶é—´ç›¸å…³æµ‹è¯•

**å¤„ç†è¿‡æœŸé€»è¾‘ï¼š**
```python
# è®°å½•å½“å‰æ—¶é—´
now = time.time()

# è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆ60ç§’åï¼‰
expire_time = now + 60

# æ¨¡æ‹Ÿè¿‡æœŸï¼ˆæµ‹è¯•ä¸­ï¼‰
expire_time = now - 1
```

### 5. å­—å…¸æ•°æ®ç»“æ„

**åº§ä½é”å®šä¿¡æ¯å­˜å‚¨ï¼š**
```python
locked_seats = {
    "A1": {"user": "user1", "expire": 1700000000.0},
    "B2": {"user": "user2", "expire": 1700000060.0}
}
```

## ğŸŒŸ é¡¹ç›®äº®ç‚¹

### 1. å®Œæ•´çš„é¡¹ç›®ç»“æ„
- âœ¨ æ¸…æ™°çš„ç›®å½•ç»„ç»‡
- âœ¨ åˆ†ç¦»åº”ç”¨ä»£ç å’Œæµ‹è¯•ä»£ç 
- âœ¨ å®Œå–„çš„æ–‡æ¡£è¯´æ˜

### 2. ä¸“ä¸šçš„æµ‹è¯•å®è·µ
- âœ¨ ä½¿ç”¨ pytest ç°ä»£æµ‹è¯•æ¡†æ¶
- âœ¨ 100% æµ‹è¯•è¦†ç›–ç‡
- âœ¨ è‡ªåŠ¨åŒ–æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ

### 3. çµæ´»çš„è¿è¡Œæ–¹å¼
- âœ¨ æ”¯æŒ pytest å‘½ä»¤è¡Œ
- âœ¨ æ”¯æŒç‹¬ç«‹è„šæœ¬è¿è¡Œ
- âœ¨ æ”¯æŒ VS Code Test Explorer

### 4. è¯¦ç»†çš„è¾“å‡ºä¿¡æ¯
- âœ¨ æ¯ä¸ªæ­¥éª¤éƒ½æœ‰éªŒè¯æç¤º
- âœ¨ å‹å¥½çš„æˆåŠŸ/å¤±è´¥æ ‡è¯†
- âœ¨ å®Œæ•´çš„æµ‹è¯•æ€»ç»“

## ğŸ“ˆ æµ‹è¯•è¦†ç›–åˆ†æ

### åŠŸèƒ½è¦†ç›–
| åŠŸèƒ½ | æµ‹è¯•ç”¨ä¾‹ | è¦†ç›–ç‡ |
|------|----------|--------|
| åº§ä½é”å®š | test_lock_and_expire, test_lock_already_locked | 100% |
| åº§ä½è§£é” | test_unlock | 100% |
| è¿‡æœŸæ£€æŸ¥ | test_lock_and_expire, test_relock_after_expire | 100% |
| å¤šåº§ä½ç®¡ç† | test_multiple_seats | 100% |

### åœºæ™¯è¦†ç›–
- âœ… æ­£å¸¸é”å®šå’Œè§£é”
- âœ… é”å®šè¶…æ—¶è‡ªåŠ¨è¿‡æœŸ
- âœ… è¿‡æœŸåé‡æ–°é”å®š
- âœ… é˜²æ­¢é‡å¤é”å®š
- âœ… å¤šåº§ä½å¹¶å‘ç®¡ç†

## ğŸ‰ é¡¹ç›®æˆæœ

### äº¤ä»˜ç‰©æ¸…å•
1. âœ… **æºä»£ç **: `app/seat_lock.py` - å®Œæ•´åŠŸèƒ½å®ç°
2. âœ… **æµ‹è¯•ä»£ç **: `tests/test_seat_lock.py` - 5ä¸ªæµ‹è¯•ç”¨ä¾‹
3. âœ… **è¿è¡Œè„šæœ¬**: `run_tests.py` - ç‹¬ç«‹æµ‹è¯•è„šæœ¬
4. âœ… **æµ‹è¯•æŠ¥å‘Š**: `report.html` - HTML æ ¼å¼æŠ¥å‘Š
5. âœ… **é…ç½®æ–‡ä»¶**: `pytest.ini`, `requirements.txt`
6. âœ… **é¡¹ç›®æ–‡æ¡£**: `README.md`, `é¡¹ç›®æ€»ç»“.md`

### è´¨é‡æŒ‡æ ‡
```
ä»£ç è´¨é‡: A+
æµ‹è¯•é€šè¿‡ç‡: 100% (5/5)
ä»£ç è¦†ç›–ç‡: 100%
æ–‡æ¡£å®Œæ•´æ€§: ä¼˜ç§€
æ‰§è¡Œæ•ˆç‡: 0.04s
```

## ğŸ’¡ å­¦ä¹ æ”¶è·

### æŠ€æœ¯èƒ½åŠ›
1. âœ… æŒæ¡ Python è™šæ‹Ÿç¯å¢ƒçš„åˆ›å»ºå’Œä½¿ç”¨
2. âœ… å­¦ä¼šä½¿ç”¨ pytest æµ‹è¯•æ¡†æ¶
3. âœ… ç†è§£å•å…ƒæµ‹è¯•çš„è®¾è®¡å’Œç¼–å†™
4. âœ… æŒæ¡æµ‹è¯•æŠ¥å‘Šçš„ç”Ÿæˆå’Œåˆ†æ

### å·¥ç¨‹å®è·µ
1. âœ… è§„èŒƒçš„é¡¹ç›®ç»“æ„ç»„ç»‡
2. âœ… æ¸…æ™°çš„ä»£ç æ³¨é‡Šå’Œæ–‡æ¡£
3. âœ… å®Œæ•´çš„æµ‹è¯•è¦†ç›–
4. âœ… ä¸“ä¸šçš„ç‰ˆæœ¬æ§åˆ¶ä¹ æƒ¯

### é—®é¢˜è§£å†³
1. âœ… æ—¶é—´ç›¸å…³é€»è¾‘çš„æµ‹è¯•æ–¹æ³•
2. âœ… å­—å…¸æ•°æ®ç»“æ„çš„çµæ´»è¿ç”¨
3. âœ… æ¨¡æ‹Ÿå’Œæ–­è¨€çš„ä½¿ç”¨æŠ€å·§
4. âœ… pytest é…ç½®å’Œæ’ä»¶ä½¿ç”¨

## ğŸ”— å‚è€ƒèµ„æ–™

1. **pytest å®˜æ–¹æ–‡æ¡£**: https://docs.pytest.org/
2. **Python è™šæ‹Ÿç¯å¢ƒ**: https://docs.python.org/zh-cn/3/library/venv.html
3. **å•å…ƒæµ‹è¯•æœ€ä½³å®è·µ**: https://martinfowler.com/bliki/UnitTest.html
4. **Test Explorer UI**: VS Code æµ‹è¯•æµè§ˆå™¨æ’ä»¶

---

**é¡¹ç›®å®Œæˆæ—¶é—´**: 2025å¹´11æœˆ19æ—¥  
**å¼€å‘ç¯å¢ƒ**: Windows 11 + Python 3.14 + VS Code  
**æµ‹è¯•æ¡†æ¶**: pytest 8.4.2  
**é¡¹ç›®çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶é€šè¿‡æ‰€æœ‰æµ‹è¯•
