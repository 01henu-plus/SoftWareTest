"""
╔══════════════════════════════════════════════════════════════╗
║          集成测试案例（课堂作业）：订单系统                    ║
╚══════════════════════════════════════════════════════════════╝

【任务说明】
构建一个简单的 "订单系统"（下单模块 + 库存模块 + 支付模块），每个模块
单元测试通过后，在 VS Code 中用 requests 库模拟 API 调用，进行集成测试。

【使用工具】
• VS Code + Python + Flask（搭建小服务）
• Postman 或 VS Code REST Client 插件测试接口
• requests 库进行 API 测试

【课堂练习目标】
• 学生修改一个模块接口参数，观察集成测试是否能发现异常

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【项目文件结构】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

├── app.py                  # Flask 应用主文件，提供订单 API
├── test_integration.py     # 集成测试文件（使用 requests）
├── manual_test.py          # 手动测试脚本（详细输出）
├── run_test.ps1            # PowerShell 快速启动脚本
├── 课堂作业.py             # 本文件（说明文档）
└── README.md               # 详细文档

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【快速开始 - 两种运行方式】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

方式 1: 分终端运行（推荐学习）
  终端 1 - 启动服务:
    > python app.py
    或
    > E:/python3.14/python.exe app.py
  
  终端 2 - 运行测试:
    > python manual_test.py        # 详细输出
    或
    > pytest test_integration.py -v  # pytest 格式

方式 2: PowerShell 脚本（快速演示）
  > .\run_test.ps1

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【API 接口文档】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

POST /order - 创建订单

请求示例:
  POST http://127.0.0.1:5000/order
  Content-Type: application/json
  
  {
    "item": "book",
    "qty": 2
  }

成功响应 (200):
  {
    "success": true,
    "剩余库存": 8
  }

失败响应 (400):
  {
    "error": "不存在的商品"
  }
  或
  {
    "error": "库存不足"
  }

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【测试覆盖范围】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

✓ 正常下单流程（book, qty=2）
✓ 商品不存在异常（phone, qty=1）
✓ 库存不足异常（book, qty=100）

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【课堂练习建议】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

练习 1: 接口参数不匹配
  在 app.py 第 11 行，将 "item" 改为 "product":
    item = request.json.get("product")  # 原: "item"
  
  重启服务，运行测试，观察集成测试能否捕获这个错误。

练习 2: 增加新的测试用例
  在 test_integration.py 中添加:
  • 测试数量为 0 的情况
  • 测试数量为负数的情况
  • 测试缺少必填参数的情况

练习 3: 扩展功能
  添加新的 API 端点:
  • GET /inventory - 查询当前库存
  • POST /refund - 退货（增加库存）
  
  并为新功能编写集成测试。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【故障排查】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

问题: 端口 5000 被占用
解决: 在 app.py 最后一行修改端口
  app.run(debug=True, port=5001)

问题: 测试失败 - Connection Error
解决: 确保 Flask 服务已启动并正在运行

问题: ModuleNotFoundError: flask
解决: pip install flask requests

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
【学习要点】
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 集成测试 vs 单元测试
   集成测试关注多个模块之间的协作是否正常

2. API 测试方法
   使用 requests 库模拟真实的 HTTP 请求

3. 断言与验证
   验证响应状态码、响应体内容是否符合预期

4. 接口契约
   前后端需要对 API 接口的参数、格式达成一致约定

╔══════════════════════════════════════════════════════════════╗
║  提示: 详细文档请查看 README.md                                ║
╚══════════════════════════════════════════════════════════════╝
"""

if __name__ == "__main__":
    print(__doc__)
