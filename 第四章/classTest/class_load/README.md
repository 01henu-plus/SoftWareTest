# 负载/性能测试 - 课堂作业

## 项目概述

**目标:** 使用 Python + Locust 在 VS Code 中模拟 100 用户同时请求 /order 接口，观察响应时间。

**位置:** `c:\Users\28298\Desktop\HomeWork_Data\软件测试作业\第四章\classTest\class_load`

---

## 文件说明

### 1. app.py
Flask 订单系统服务，提供 `/order` API 接口。
- 初始库存设置为 100000（避免测试时库存耗尽）
- 端口：5000
- 调试模式：开启

### 2. locustfile.py
Locust 配置文件（标准方式）
- 模拟用户类：`WebsiteUser`
- 等待时间：1-3 秒
- 测试任务：POST /order 请求

### 3. test_load.py
简化的性能测试脚本（替代方案）
- 使用 Python threading 实现并发
- 不需要安装 C++ 编译器
- 提供详细的测试报告

---

## 运行方式

### 方式 1: 使用 Locust（标准方式）

**前提：** 需要安装 Locust
```powershell
pip install locust
```

**步骤：**

1. 启动 Flask 服务
```powershell
python app.py
```

2. 运行 Locust（无界面模式）
```powershell
locust -f locustfile.py --headless -u 100 -r 10 -t 30s --host=http://127.0.0.1:5000
```

3. 或者启动 Locust Web 界面
```powershell
locust -f locustfile.py
```
然后访问 http://localhost:8089

**参数说明：**
- `-u 100`: 100 个并发用户
- `-r 10`: 每秒启动 10 个用户
- `-t 30s`: 运行 30 秒
- `--host`: 目标服务器地址

---

### 方式 2: 使用简化脚本（推荐，无需编译器）

**步骤：**

1. 启动 Flask 服务
```powershell
python app.py
```

2. 在新终端运行测试脚本
```powershell
python test_load.py
```

**测试配置（可在 test_load.py 中修改）：**
- `NUM_USERS = 100`  # 并发用户数
- `DURATION = 20`    # 测试时长（秒）

---

## 测试结果示例

```
======================================================================
  性能测试 - 订单系统
======================================================================

配置:
  目标地址: http://127.0.0.1:5000
  测试端点: /order
  并发用户: 100
  测试时长: 20 秒

开始时间: 2025-11-19 16:19:24

正在启动用户...
  已启动 10 个用户...
  已启动 20 个用户...
  ...
  已启动 100 个用户...

所有用户已启动，测试运行中...

======================================================================
  测试结果
======================================================================

结束时间: 2025-11-19 16:19:44

请求统计:
  总请求数: 2000
  成功: 2000 (100.0%)
  失败: 0 (0.0%)

响应时间:
  平均: 8.48 ms
  最小: 2.00 ms
  最大: 35.50 ms

吞吐量:
  RPS (每秒请求数): 100.00
```

---

## 关键指标说明

### 1. 请求统计
- **总请求数**: 测试期间发送的请求总数
- **成功率**: 状态码为 200 的请求占比
- **失败率**: 非 200 状态码或异常的请求占比

### 2. 响应时间
- **平均响应时间**: 所有请求的平均响应时间（毫秒）
- **最小响应时间**: 最快的请求响应时间
- **最大响应时间**: 最慢的请求响应时间

### 3. 吞吐量
- **RPS (Requests Per Second)**: 每秒处理的请求数
- 越高表示系统处理能力越强

---

## 性能优化建议

根据测试结果，可以进行以下优化：

1. **响应时间 > 100ms**
   - 检查数据库查询效率
   - 添加缓存机制
   - 优化代码逻辑

2. **成功率 < 95%**
   - 检查错误日志
   - 增加错误处理
   - 检查资源限制

3. **RPS 不足**
   - 使用生产级 WSGI 服务器（如 Gunicorn, uWSGI）
   - 增加服务器资源
   - 实现负载均衡

---

## 注意事项

1. **开发服务器警告**
   - Flask 内置服务器仅用于开发
   - 生产环境应使用 Gunicorn 等 WSGI 服务器

2. **库存管理**
   - app.py 中库存设置为 100000 是为了避免测试时库存耗尽
   - 实际生产环境需要考虑并发安全和库存同步

3. **线程安全**
   - 当前实现的库存扣减不是线程安全的
   - 真实场景需要使用数据库事务或锁机制

---

## 扩展练习

1. **修改并发数**
   - 尝试 10, 50, 100, 200, 500 用户
   - 观察响应时间和成功率的变化

2. **增加测试时长**
   - 从 20 秒增加到 60 秒或更长
   - 观察系统稳定性

3. **添加其他接口**
   - 添加查询库存接口 GET /inventory
   - 添加退货接口 POST /refund
   - 同时测试多个接口

4. **使用真实数据库**
   - 将内存字典替换为 SQLite/MySQL
   - 观察数据库对性能的影响

---

**创建时间:** 2025年11月19日  
**作业类型:** 系统测试 - 负载/性能测试
