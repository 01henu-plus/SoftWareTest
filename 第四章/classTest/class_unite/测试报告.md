# 单元测试报告 - 转账函数

## 测试概述

**项目:** 转账函数单元测试（课堂作业）  
**日期:** 2025年11月20日  
**测试类型:** 单元测试  
**工具:** VS Code + Python + pytest + unittest.mock

---

## 测试要求

根据图片要求，测试 `transfer(accountA, accountB, amount)` 函数：

**测试点：**
- ✅ 余额不足
- ✅ 负数金额
- ✅ 跨用户正常转账
- ✅ 使用 unittest.mock 验证

---

## 测试结果

### 执行命令
```powershell
pytest -v test_integration.py
```

### 测试输出
```
collected 5 items

test_integration.py::TestTransferFunction::test_余额不足 PASSED        [ 20%]
test_integration.py::TestTransferFunction::test_负数金额 PASSED        [ 40%]
test_integration.py::TestTransferFunction::test_跨用户正常转账 PASSED  [ 60%]
test_integration.py::TestTransferFunction::test_使用mock验证调用 PASSED [ 80%]
test_integration.py::test_零金额转账 PASSED                           [100%]

============= 5 passed in 0.05s =============
```

---

## 测试用例详情

| 测试用例 | 测试内容 | 输入 | 预期结果 | 实际结果 | 状态 |
|---------|---------|------|---------|---------|------|
| test_余额不足 | 账户A余额100，转账200 | `transfer(A, B, 200)` | 抛出 ValueError | ✅ ValueError | PASSED |
| test_负数金额 | 转账金额为负数 | `transfer(A, B, -100)` | 抛出 ValueError | ✅ ValueError | PASSED |
| test_跨用户正常转账 | A有1000，转200给B | `transfer(A, B, 200)` | A=800, B=700 | ✅ 余额正确 | PASSED |
| test_使用mock验证调用 | Mock对象验证方法调用 | `transfer(mock_A, mock_B, 300)` | 调用withdraw/deposit | ✅ 调用验证 | PASSED |
| test_零金额转账 | 转账金额为0 | `transfer(A, B, 0)` | 抛出 ValueError | ✅ ValueError | PASSED |

---

## 代码覆盖率

```
Name     Stmts   Miss  Cover
----------------------------
app.py      28      7    75%
----------------------------
TOTAL       28      7    75%
```

**覆盖率:** 75% ✅

---

## 核心代码

### app.py - 转账函数实现

```python
class Account:
    """账户类"""
    def __init__(self, name, balance=0):
        self.name = name
        self.balance = balance
    
    def withdraw(self, amount):
        """取款"""
        if amount < 0:
            raise ValueError("金额不能为负数")
        if amount > self.balance:
            raise ValueError("余额不足")
        self.balance -= amount
        return self.balance

def transfer(from_account, to_account, amount):
    """转账函数"""
    if amount <= 0:
        raise ValueError("转账金额必须大于0")
    from_account.withdraw(amount)
    to_account.deposit(amount)
    return True
```

### test_integration.py - 测试用例

```python
import pytest
from unittest.mock import Mock
from app import Account, transfer

class TestTransferFunction:
    def test_余额不足(self):
        account_a = Account("用户A", 100)
        account_b = Account("用户B", 500)
        with pytest.raises(ValueError, match="余额不足"):
            transfer(account_a, account_b, 200)
    
    def test_跨用户正常转账(self):
        account_a = Account("用户A", 1000)
        account_b = Account("用户B", 500)
        result = transfer(account_a, account_b, 200)
        assert account_a.balance == 800
        assert account_b.balance == 700
    
    def test_使用mock验证调用(self):
        mock_from = Mock()
        mock_to = Mock()
        transfer(mock_from, mock_to, 300)
        mock_from.withdraw.assert_called_once_with(300)
        mock_to.deposit.assert_called_once_with(300)
```

---

## 测试统计

- **总测试数:** 5
- **通过数:** 5 ✅
- **失败数:** 0
- **通过率:** 100%
- **执行时间:** 0.05 秒
- **代码覆盖率:** 75%

---

## 测试结论

✅ **所有单元测试通过**

1. 余额不足场景正确抛出异常
2. 负数金额场景正确拦截
3. 正常转账逻辑验证通过
4. Mock 对象验证方法调用成功
5. 边界条件（零金额）测试通过

**课堂作业要求完成度:** 100% ✅

---

**测试执行人:** GitHub Copilot  
**状态:** ✅ 全部通过  
**完成时间:** 2025年11月20日
