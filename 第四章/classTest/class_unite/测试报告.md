# 集成测试执行报告 - classFunction

## 测试概述

**项目:** 订单系统集成测试  
**位置:** `c:\Users\28298\Desktop\HomeWork_Data\软件测试作业\第四章\classTest\classFunction`  
**日期:** 2025年11月19日  
**测试类型:** API 集成测试

---

## 项目文件

根据课堂作业要求创建了以下文件：

1. **app.py** - Flask 订单系统 API
   - 路由: `POST /order`
   - 功能: 处理订单下单请求
   - 库存管理: 初始库存 `{"book": 10}`
   - 错误处理: 商品不存在、库存不足

2. **test_integration.py** - 集成测试文件
   - 测试函数: `test_order_api()`
   - 测试框架: pytest
   - HTTP 库: requests

---

## 执行步骤

### 1. 启动 Flask 服务
```powershell
E:/python3.14/python.exe app.py
```

**启动结果:**
```
 * Serving Flask app 'app'
 * Debug mode: on
 * Running on http://127.0.0.1:5000
 * Debugger is active!
```
✅ 服务启动成功

### 2. 运行 pytest 测试
```powershell
pytest -v test_integration.py
```

**测试结果:**
```
=========================================================================== test session starts ============================================================================
platform win32 -- Python 3.14.0, pytest-8.4.2, pluggy-1.6.0
collected 1 item

test_integration.py::test_order_api PASSED                                [100%]

============================================================================ 1 passed in 0.09s =============================================================================
```

---

## 测试详情

### API 测试用例

| 测试函数 | 测试内容 | 请求数据 | 预期状态码 | 预期响应 | 实际结果 |
|---------|---------|---------|-----------|---------|---------|
| test_order_api | 正常下单 | `{"item": "book", "qty": 2}` | 200 | `{"success": True}` | ✅ PASSED |

### API 请求响应详情

**请求:**
```http
POST http://127.0.0.1:5000/order
Content-Type: application/json

{
  "item": "book",
  "qty": 2
}
```

**响应:**
```json
{
  "success": true,
  "剩余库存": 8
}
```

**HTTP 状态码:** 200 OK  
**响应时间:** < 0.1 秒

---

## 测试结果统计

- **总测试数:** 1
- **通过数:** 1
- **失败数:** 0
- **跳过数:** 0
- **通过率:** 100% ✅
- **执行时间:** 0.09 秒

---

## 代码实现

### app.py (Flask 服务)

```python
# file: app.py
from flask import Flask, request, jsonify

app = Flask(__name__)

# 模拟库存
inventory = {"book": 10}

@app.route("/order", methods=["POST"])
def order():
    item = request.json.get("item")
    qty = request.json.get("qty", 1)
    
    if item not in inventory:
        return jsonify({"error": "不存在的商品"}), 400
    
    if inventory[item] < qty:
        return jsonify({"error": "库存不足"}), 400
    
    inventory[item] -= qty
    return jsonify({"success": True, "剩余库存": inventory[item]})

if __name__ == "__main__":
    app.run(debug=True, port=5000)
```

### test_integration.py (测试文件)

```python
# file: test_integration.py
import requests

def test_order_api():
    url = "http://127.0.0.1:5000/order"
    res = requests.post(url, json={"item": "book", "qty": 2})
    assert res.status_code == 200
    assert res.json()["success"] == True
```

---

## 运行命令总结

按照图片要求的运行方式：

### 方式 1: flask run
```powershell
flask run
```

### 方式 2: pytest (推荐)
```powershell
pytest -v test_integration.py
```

---

## 测试结论

✅ **集成测试完全通过**

1. Flask API 服务正常启动
2. API 端点 `/order` 响应正确
3. 请求/响应格式符合预期
4. 状态码处理正确
5. JSON 数据解析成功
6. 断言全部通过

---

## 课堂练习建议

### 练习 1: 修改接口参数
在 `app.py` 第 11 行，将 `"item"` 改为 `"product"`：
```python
item = request.json.get("product")  # 原来是 "item"
```
然后重新运行测试，观察集成测试能否发现接口不匹配问题。

### 练习 2: 添加更多测试
扩展 `test_integration.py`，添加：
- 测试不存在的商品
- 测试库存不足
- 测试数量为 0 或负数

### 练习 3: 使用 Postman
使用 Postman 手动测试 API：
- URL: `http://127.0.0.1:5000/order`
- Method: POST
- Body: `{"item": "book", "qty": 2}`

---

**测试执行人:** GitHub Copilot  
**状态:** ✅ 通过  
**完成时间:** 2025年11月19日 16:00
